<!DOCTYPE html>
<html>
	<head>
		<title>Agar.io clone</title>
		<script src="//cdn.jsdelivr.net/npm/phaser@3.22.0/dist/phaser.min.js"></script>
	</head>
	<body>
	<script type="text/javascript">
		
		var config = {
	    type: Phaser.AUTO,
	    width: window.screen.width,
	    height: window.screen.height,
	    physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 0 },
                debug: false
            }
        },
	    scene: {
	        preload: preload,
	        create: create,
	        update: update
	    }
	};


	function preload ()
	{
	    this.load.image('background', 'assets/background.png');
	    this.load.image('player', 'assets/player.png');
	    this.load.image('food1', 'assets/food1.png');
	    this.load.image('food2', 'assets/food2.png');
	    this.load.image('food3', 'assets/food3.png');
	    this.load.image('food4', 'assets/food4.png');
	}

	var game = new Phaser.Game(config);
	var lastClick;
	var mass;
	var maxSpeed;
	var cursor;
	var player;
	var score;
	var timer;
	var width;
	var height;
	var food = [];


	function clamp(num, min, max) {
	  return num <= min ? min : num >= max ? max : num;
	}

	function move(pointer)
	{
		//var velocityX = clamp(, -maxSpeed, maxSpeed);
		//var velocityY = clamp(, -maxSpeed, maxSpeed);
		player.setVelocityX((pointer.worldX - player.x) * 3 / (mass * .1));
		player.setVelocityY((pointer.worldY - player.y) * 3 / (mass * .1));
		lastClick.x = pointer.worldX;
		lastClick.y = pointer.worldY;
	}
	function foodCollideProcess(playerGO, foodGO)
	{
		mass++;
		player.setScale(.1 + mass * .005);
		foodGO.destroy();
		return true;
	}

	function foodCollide(playerGO, foodGO)
	{

	}

	function addFood(scene)
	{
		food.push(scene.physics.add.sprite(Math.random() * width, Math.random() * height, "food" + Math.floor(Math.random() * 4 + 1)));
	}

	function create ()
	{
		width = 10000;
		height = 10000;
		mass = 1;
		maxSpeed = 300;
		score = 0;
		timer = new Phaser.Time.Clock(this);
		lastClick = new Phaser.Geom.Point(width / 2, height / 2);
		//this.add.tileSprite(width / 2, height / 2,800,600, 'background');
	   for (x = 0; x < 20; x++)
	    {
	        for (var y = 0; y < 20; y++) {
	        	this.add.image(760 * x, 600 * y, 'background').setOrigin(0);
	        }
	    }
		player = this.physics.add.sprite(width / 2, height / 2, 'player');
		player.smoothed = false;
		player.setScale(.1 + mass * .01);


		this.input.on('pointermove', move);
		timer.scene.time.addEvent({delay: 100, loop: true, callback: addFood, args: [this] });

		this.cameras.main.setBounds(0,0, width, height);
		this.cameras.main.startFollow(player);
	}


	function update ()
	{
		if(player.x != lastClick.x || player.x != lastClick.y)
		{
			//move(lastClick);
		}
		this.physics.collide(player, food, foodCollide, foodCollideProcess);
		//this.cameras.main.centerOn(player.x, player.y);
	}
	</script>
	</body>
</html>