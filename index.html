<!DOCTYPE html>
<html>
	<head>
		<title>Agar.io clone</title>
		<script src="//cdn.jsdelivr.net/npm/phaser@3.22.0/dist/phaser.min.js"></script>
	</head>
	<body>
	<script type="text/javascript">
		
		var config = {
	    type: Phaser.AUTO,
	    width: 800,
	    height: 600,
	    physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 0 },
                debug: false
            }
        },
	    scene: {
	        preload: preload,
	        create: create,
	        update: update
	    }
	};


	function preload ()
	{
	    this.load.image('background', 'assets/background.png');
	    this.load.image('player', 'assets/player.png');
	    this.load.image('food1', 'assets/food1.png');
	    this.load.image('food2', 'assets/food2.png');
	    this.load.image('food3', 'assets/food3.png');
	    this.load.image('food4', 'assets/food4.png');
	}

	var game = new Phaser.Game(config);
	var lastClick;
	var mass;
	var maxSpeed;
	var cursor;
	var player;
	var score;
	var timer;
	var width;
	var height;
	var food = [];


	function clamp(num, min, max) {
	  return num <= min ? min : num >= max ? max : num;
	}

	function move(pointer)
	{
		var velocityX = clamp((pointer.x - player.x) * 3 / (mass * .2), -maxSpeed, maxSpeed);
		var velocityY = clamp((pointer.y - player.y) * 3 / (mass * .2), -maxSpeed, maxSpeed);
		player.setVelocityX(velocityX);
		player.setVelocityY(velocityY);
		lastClick.x = pointer.x;
		lastClick.y = pointer.y;
	}
	function foodCollideProcess(playerGo, foodGO)
	{
		return true;
	}
	function foodCollide(playerGO, foodGO)
	{
		mass++;
		playerGO.setScale(1 + mass * .04);
		foodGO.destroy();
	}

	function addFood(scene)
	{
		food.push(scene.physics.add.sprite(Math.random() * width, Math.random() * height, "food" + Math.floor(Math.random() * 4 + 1)));
	}

	function create ()
	{
		width = game.config.width;
		height = game.config.height;
		mass = 1;
		maxSpeed = 300;
		score = 0;
		timer = new Phaser.Time.Clock(this);
		lastClick = new Phaser.Geom.Point(width / 2, height / 2);
		this.add.image(width / 2, height / 2, 'background');
		player = this.physics.add.sprite(width / 2, height / 2, 'player');


		this.input.on('pointermove', move);
		timer.scene.time.addEvent({delay: 500, loop: true, callback: addFood, args: [this] });
	}


	function update ()
	{
		if(player.x != lastClick.x || player.x != lastClick.y)
		{
			move(lastClick);
		}
		this.physics.collide(player, food, foodCollide, foodCollideProcess);

	}
	</script>
	</body>
</html>